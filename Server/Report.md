# 网络原理“微信”实验报告

计53 王润基 2015011279

## 实验原理和内容

在Linux上使用Socket实现聊天程序的服务器和客户端。

实现以下基本功能：

* 用户注册和登陆
* 查找并添加好友
* 好友之间发送消息和文件
* 用户帐户和联系人信息同步

## 实现细节

服务端使用C++，客户端使用Python，通信协议使用Protobuf

### 通信协议

使用Protobuf定义，详见`src/protobuf/chat.proto`文件

实际发送的数据是Protobuf序列化的数据并在前面附加4字节的消息长度，以解决recv函数不能一次性接收全部数据的问题。

### 服务端

* Server类：实现核心业务逻辑，接受Request，返回Response。
* SocketServer类：包在Server类外面，监听Socket TCP请求，对每一个连接新开线程，实现消息的正反序列化，调用Server函数。

### 客户端

* SocketClient类：包装了socket接口，实现Socket的连接和消息的正反序列化。
* Client类：包在SocketClient类外面，实现客户端业务逻辑。
* ClientCLI类：包在Client类外面，接收命令行输入，解析后调用Client函数，输出结果。

## 遇到的问题

1. 当消息长度较大时，recv函数不能一次性接收全部数据，因此需要在消息头部标记总长度，以确定何时结束一条消息的接收。

## 思考题

1. Linux下，Socket是一种文件，可以打开关闭读写。
2. 服务器作为消息和命令的处理者和转发者，是核心角色。
3. 端口数与客户端连接个数没有直接关系，但当连接个数增加时也增加端口数可以减轻压力。